var APP={url:"basket.html",init:function(){document.getElementsByClassName||(document.getElementsByClassName=function(cn){for(var a,allT=document.getElementsByTagName("*"),allCN=[],i=0;a=allT[i++];)a.className==cn?allCN[allCN.length]=a:null;return allCN}),APP.amendQuantitiesBtns(),APP.quantityChange(),APP.trashBtns();var buy_now_btn=document.getElementsByClassName("buy_now_button");buy_now_btn[0].onclick=function(e){e.preventDefault();var total=document.getElementsByClassName("total")[0].innerHTML;0==total?alert("You have no items in your basket"):APP.ajaxPost()}},amendQuantitiesBtns:function(){var qtyUpBtns=document.getElementsByClassName("up"),qtyDownBtns=document.getElementsByClassName("down");for(i=0;i<qtyUpBtns.length;i++)qtyUpBtns[i].onclick=function(e){e.preventDefault();var classes=this.className.split(" "),rgx=/item[0-9]{1,2}_qty/;for(i=0;i<classes.length;i++){var test=rgx.test(classes[i]);if(test===!0){var elm=document.getElementById(classes[i]),val=elm.value;9>=val&&(elm.value=parseInt(val)+1,elm.onchange())}}},qtyDownBtns[i].onclick=function(e){e.preventDefault();var classes=this.className.split(" "),rgx=/item[0-9]{1,2}_qty/;for(i=0;i<classes.length;i++){var test=rgx.test(classes[i]);if(test===!0){var elm=document.getElementById(classes[i]),val=elm.value;val>0&&(elm.value=parseInt(val)-1,elm.onchange())}}}},quantityChange:function(){var quantity=document.getElementsByClassName("quantity");for(i=0;i<quantity.length;i++)quantity[i].onchange=function(){var qty=this.value;qty>10&&(this.value=10,alert("There is a maximum of 10 items aloud. Sorry for the inconvenience.")),APP.updateTotals()}},trashBtns:function(){var trashBtns=document.getElementsByClassName("trash");for(i=0;i<trashBtns.length;i++)trashBtns[i].onclick=function(e){e.preventDefault();{var classes=this.className.split(" ");this.getAttribute("href")}for(k=0;k<classes.length;k++)if("trash"!=classes[k]&&"remove_"==classes[k].substr(0,7)){var id=classes[k].substr(7),elm=document.getElementById(id);elm.parentNode.removeChild(elm),APP.updateTotals()}}},ajaxPost:function(){var json=Array(),elms=document.getElementsByClassName("quantity");for(i=0;i<elms.length;i++){var classes=elms[i].className.split(" "),rgx=/sku[0-9]{4}/;for(k=0;k<classes.length;k++){var test=rgx.test(classes[k]);test===!0&&(json[i]=[classes[k].substr(3),elms[i].value])}}if(window.XMLHttpRequest)var req=new XMLHttpRequest;else var req=new ActiveXObject("Microsoft.XMLHTTP");req.onreadystatechange=function(){4===req.readyState&&200===req.status&&alert("Updated basket complete")},req.open("POST",APP.url,!0),req.send(JSON.stringify(json))},updateTotals:function(){var price=document.getElementsByClassName("single_cost"),quantity=document.getElementsByClassName("quantity"),cost=document.getElementsByClassName("quantity_cost"),subtotal=0,vat=0,total=0;for(i=0;i<price.length;i++){var single_cost=parseFloat(price[i].innerHTML),qty=parseInt(quantity[i].value),the_cost=single_cost*qty;the_cost=the_cost.toFixed(2),cost[i].innerHTML=the_cost,subtotal=(parseFloat(subtotal)+parseFloat(the_cost)).toFixed(2)}vat=(subtotal/100*20).toFixed(2),total=(parseFloat(subtotal)+parseFloat(vat)).toFixed(2),document.getElementsByClassName("subtotal")[0].innerHTML=subtotal,document.getElementsByClassName("vat")[0].innerHTML=vat,document.getElementsByClassName("total")[0].innerHTML=total}};APP.init();